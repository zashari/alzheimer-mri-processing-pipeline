############################################
# Image Processing Stage Configuration     #
############################################

image_processing:
  # Sub-stage to execute (center_crop, image_enhancement, data_balancing)
  substage: "center_crop"

  # Center Crop Configuration
  center_crop:
    # Input/Output paths (relative to output_root)
    input_dir: "5_twoD"  # Output from twoD_conversion
    output_dir: "6_center_crop"  # Where to save cropped files

    # Slice types to process
    slice_types: ["axial", "coronal", "sagittal"]

    # Data splits
    splits: ["train", "val", "test"]

    # Group labels to use
    groups: ["AD", "CN"]  # Exclude MCI if not needed

    # Required visits for complete sequences
    required_visits: ["sc", "m06", "m12"]

    # Processing parameters
    crop_padding: 5  # Padding to add around brain bounding box (pixels)
    target_size: [256, 256]  # Target resolution for output images (width, height)
    rotation_angle: 180  # Rotation angle in degrees

    # Visualization
    visualization:
      enabled: true
      sample_size: 3  # Number of samples to visualize per group
      output_dir: null  # If null, uses .visualizations/image_processing/center_crop/

    # Test mode settings (for 'test' action)
    test:
      num_samples: 5  # Number of sample files to test
      save_visualization: true

  # Image Enhancement Configuration
  image_enhancement:
    # Input/Output paths (relative to output_root)
    input_dir: "6_center_crop"  # Output from center_crop
    output_dir: "7_enhanced"  # Where to save enhanced files

    # Enhancement method: 'adaptive', 'clahe', 'gabor', 'unsharp'
    method: "adaptive"

    # Grey Wolf Optimizer parameters
    gwo_iterations: 30  # Number of GWO optimization iterations
    num_wolves: 15  # Number of wolves in GWO pack

    # Parallel processing
    max_workers: 4  # Number of parallel workers

    # Slice types to process
    slice_types: ["axial", "coronal", "sagittal"]

    # Data splits
    splits: ["train", "val", "test"]

    # Group labels to use
    groups: ["AD", "CN"]  # Exclude MCI if not needed

    # Required visits for complete sequences
    required_visits: ["sc", "m06", "m12"]

    # Optional: Limit number of images per class (None = process all)
    max_images_per_class: null

    # Visualization
    visualization:
      enabled: true
      sample_size: 6  # Number of sample images to visualize
      output_dir: null  # If null, uses .visualizations/image_processing/image_enhancement/

    # Test mode settings (for 'test' action)
    test:
      num_samples: 3  # Number of sample files to test
      save_visualization: true

  # Data Balancing Configuration
  data_balancing:
    # Input/Output paths (relative to output_root)
    input_dir: "7_enhanced"  # Output from image_enhancement
    output_dir: "8_balanced"  # Where to save balanced files

    # Slice types to process
    slice_types: ["axial", "coronal", "sagittal"]

    # Group labels to use
    groups: ["AD", "CN"]  # Exclude MCI if not needed

    # Required visits for complete sequences
    required_visits: ["sc", "m06", "m12"]

    # Augmentation targets: {group: {current: int, target: int}}
    # Note: current counts are auto-detected, only target needs to be specified
    augmentation_targets:
      AD:
        target: 180  # Target number of subjects for AD class
      CN:
        target: 180  # Target number of subjects for CN class

    # Augmentation parameter ranges
    augmentation_params:
      rotation_range: [-10, 10]  # Rotation angle in degrees
      translation_range: [-10, 10]  # Translation in pixels
      elastic_alpha_range: [20, 40]  # Elastic deformation alpha
      elastic_sigma_range: [4, 6]  # Elastic deformation sigma
      bias_scale_range: [0.2, 0.4]  # Bias field scale
      motion_kernels: [3, 5, 7]  # Motion blur kernel sizes
      gamma_range: [0.8, 1.2]  # Gamma correction range
      noise_sigma_range: [5, 15]  # Rician noise sigma
      intensity_shift_range: [-15, 15]  # Intensity shift range
      motion_probability: 0.5  # Probability of applying motion blur (0.0-1.0)
      elastic_probability: 0.7  # Probability of applying elastic deformation (0.0-1.0)

    # Visualization
    visualization:
      enabled: true
      output_dir: null  # If null, uses .visualizations/image_processing/data_balancing/

    # Test mode settings (for 'test' action)
    test:
      num_samples: 2  # Number of augmented subjects to create per class in test mode
